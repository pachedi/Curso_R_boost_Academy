---
title: "Clase 6 introducción a programación"
output:
  html_document:
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 3
    #number_sections: true
    theme: lumen
---
```{r results = FALSE, warning = FALSE, message = FALSE }

library(tidyverse)
library(assertthat)
```

##Función Paste
La función paste sirve para concatenar cadenas de caracteres con el contenido de un objeto de tipo caracter.
Veamos qué pasa si intentamos imprimir un string junto a un objeto.
```{r paste, error= TRUE}
a <- "Carlos"

print("mi nombre es ", a)

```
Recibimos un error. 
Por lo tanto, debemos anidar la función paste() para lograrlo correctamente:
```{r  }
a <- "Carlos"

print(paste("mi nombre es ", a))

```

## Función readline
La función readline() sirve para ingresar datos por consola. Esto nos permite definir el valor de un objeto a partir del ingreso de información de un potencial usuario.
```{r }

nombre <- readline("¿Cuál es tu nombre?") 

```
Ahora el objeto "nombre" asume el valor introducido por consola.
Combinando estas funciones podemos imprimir el valor del objeto concatenado con una cadena de caracteres.
```{r }
nombre <- readline("¿Cuál es tu nombre? ") 
print(paste("Hola", nombre, ":)"))

```


## Condicionales if, if else, else
Tal como lo indica su nombre, if es un condicional que va a ejecutar ciertos comandos si y solo si se cumple una condición.
```{r }

grupo_a <- 7
grupo_b <- 10

aforo <- 20

if(grupo_a + grupo_b < aforo ) {
  print('Pueden pasar')
}

```
El complemento del if es else. Else refiere a una acción que va a suceder si no se cumple el condicional if.
```{r}

grupo_a <- 17
grupo_b <- 10

aforo <- 20

if(grupo_a + grupo_b < aforo ) {
  print('Pueden pasar')
} else {
  print('Aforo excedido')
}

```
Existe una 3era opción que es agregar if else. 
if else se utiliza cuando no se cumplió la 1era condición pero tenemos otra condición aceptable.
```{r}

grupo_a <- 10
grupo_b <- 10

aforo <- 20

if(grupo_a + grupo_b < aforo ) {
  print('Pueden pasar')
} else if(grupo_a + grupo_b == aforo ){
  print('Aforo completo, no puede entrar nadie más')
} else {
  print('Aforo excedido')
}

```

## Función length()
Esta función resulta fundamental a la hora de realizar ciclos definidos ya que le va a indicar a R cuántas veces debe repetir el ciclo.
```{r}

nombres <- c('Carlos', 'Maria', 'Alberto', 'Romina', 'Marta', 'Walter')

length(nombres)
```
## Ciclos definidos (for)
Los ciclos definidos son maneras de repetir acciones n cantidad de veces. Se suele usar la letra i como valor reemplazable en las iteraciones aunque se puede usar cualquier string.
```{r}
nombres <- c('Carlos', 'Maria', 'Alberto', 'Romina', 'Marta', 'Walter')

for(i in 1:length(nombres)){
  print(paste(nombres[i], 'es parte de la lista de invitadxs'))
}

```
El ciclo for va a iterar sobre el índice del vector. Es por este motivo que debemos poner el nombre del vector[i]
Tal como se mencionó previamente, i es una convención, se puede elegir otra palabra para representar el iterable.
```{r}
nombres <- c('Carlos', 'Maria', 'Alberto', 'Romina', 'Marta', 'Walter')

for(elemento in 1:length(nombres)){
  print(paste(nombres[elemento], 'es parte de la lista de invitadxs'))
}

```
Hagamos un pequeño ejercicio. Suponiendo que tenemos un data frame con una lista de invitadxs y sus edades. 
Pero sólo pueden ingresar quienes son mayores de 18. 
Queremos que R nos diga quién puede entrar y quién no utilizando un ciclo definido y los condicionales if / else
```{r}
nombres <- c('Carlos', 'Maria', 'Alberto', 'Romina', 'Marta', 'Walter')
edades <-  c(11,12,18,21,35,60)

n_y_e <- data.frame(nombres,edades)

```
Ya tenemos el data frame. Ahora iteramos sobre el mismo.
```{r}
for(i in 1:nrow(n_y_e)){ # nrow refiere a  la cantidad de filas que tiene el df
  if(n_y_e$edades[i] >= 18){
    print(paste('Le invitadx', n_y_e$nombres[i], 'está habilitadx'))
  } else{print(paste('Le invitadx', n_y_e$nombres[i], ' *NO* está habilitadx'))}
} 

```
El resultado es un print de pantalla.
¿Qué pasa si lo quiero guardar en un data frame?
Vamos a crear una lista vacía.
Si se cumple el condicional de >= 18, va a agregar el nombre a la lista con la función append()

```{r}

lista_de_invitadxs <- c()

for(i in 1:nrow(n_y_e)){
  if(n_y_e$edades[i] >= 18){
    print(paste('Invitadx', n_y_e$nombres[i], 'está habilitadx'))
    lista_de_invitadxs <- append(lista_de_invitadxs,n_y_e$nombres[i])
  } else{print(paste('Invitadx', n_y_e$nombres[i], ' *NO* está habilitadx'))}
} 

lista_df <- as.data.frame(lista_de_invitadxs)

lista_df <- lista_df %>% 
  rename('Invitadxs habilitadxs'= 1 )

lista_df
```
## Ciclos indefinidos while()

Para crear un ciclo indefinido debemos introducir una sentencia lógica dentro del while y dentro de las llaves el código.
Los ciclos se van a repetir hasta que la sentencia lógica sea FALSE
```{r }
numero <- 0

while(numero < 10){
  numero <- numero + 1
  print(numero)
}

```
Existen 2 comandos importantes a tener en cuenta en los ciclos indefinidos:
next y break.
Next le indica al ciclo que saltee un valor por más que rompa el ciclo.

```{r }
numero <- 0

nombres <- c("Carlos", "Pepe","Maria","Homero")

while(numero < 5){
  numero <- numero + 1
  for(i in nombres){
    if(i == "Homero"){
      print("No se permiten Homeros")
      next 
    }
    print(i)
  }
}

```

```{r }
numero <- 0

while(numero < 5){
  numero <- numero + 1
  print(numero)
  if(numero == 3){
    break
  }
}
```

```{r }

```
## FUNCIONES
Las funciones sirven para automatizar acciones que se repiten
Podemos crear las funciones que necesitemos con distintos tipos de complejidad
Lo importante es seguir la estructura de R
Función muy simple:
```{r}
suma <- function(a,b){
  a + b
}
suma(1, 2)

```
Pueden surgir errores y existen maneras de "controlar" esos errores.
La función assert_that nos permite crear mensajes para errores controlados.
Por ejemplo si alguien quiere usar la funcion suma() con un string.
```{r error = TRUE}

suma <- function(a, b){
  assert_that(is.numeric(a),
                          msg = "Ingrese un valor numérico")
  assert_that(is.numeric(b),
                          msg = "Ingrese un valor numérico")
  return(a + b)
}

suma(1, 'a')

```
Hagamos una función entonces para calcular los contagios cada 100mil habitantes.
```{r results = FALSE, warning = FALSE, message = FALSE}

cada_100_mil <- function(valor, poblacion, nombre){
   valor <- as.numeric(valor)
   poblacion <- as.numeric(poblacion)
   res <- valor / poblacion * 100000
  print(paste(nombre, 'tiene', res, 'contagios cada 100 mil habitantes'))
}

valor <- readline('Indique la cantidad de contagios: ')
poblacion <- readline('Indique la cantidad de población del lugar: ')
nombre <- readline(('Indique el nombre del lugar: '))

cada_100_mil(valor, poblacion, nombre)

```
  
## Juego para adivinar el número.
Conociendo estas funciones básicas podemos programar un juego muy simple para adivinar números.
El comando readline sirve para ingresar información por consola.
sample() nos crea una muestra de un intervalo.
```{r results = FALSE, warning = FALSE, message = FALSE}

nombre <- readline('¿Cómo es tu nombre? ') # ingresa nombre por consola

print(paste('Hola',nombre, 'bienvenidx al adivinador. ¿Tendrás suerte?', sep= ' '))
# imprime el mensaje de bienvenida con el nombre
secreto <- sample(1:100, size = 1)
# se crea un número aleatorio entre 1 y 100
elegido <- ''
# se crea el objeto de número elegido como vacío 
```

Creamos un ciclo indefinido que se perpetúa mientras elegido y secreto sean distintos
```{r error = TRUE, results = FALSE, warning = FALSE, message = FALSE}
nombre <- readline('¿Cómo es tu nombre? ')

cat(paste('Hola',nombre, 'bienvenidx al adivinador. ¿Tendrás suerte?\n', sep= ' '))

secreto <- sample(1:100, size = 1)

elegido <- ''
  
while (elegido != secreto) {

elegido <- as.integer(readline('Elija un número del 1 al 100: ')) # ingreso valor por consola que define nuestro número

}

```

Si el usuario tipea letras en vez de números, cuando lo queremos transformar a entero, R al no poder convertilo, lo va a trnsformar en NA.
Por lo tanto, agregamos un condicional if que si el objeto "elegido" es NA entonces imprima un mensaje de error y corte el ciclo indefinido con el comando break.
```{r results = FALSE, warning = FALSE, message = FALSE}

nombre <- readline('¿Cómo es tu nombre? ')

cat(paste('Hola',nombre, 'bienvenidx al adivinador. ¿Tendrás suerte?\nElige un número del 1 al 100: ', sep= ' '))

secreto <- sample(1:100, size = 1)

elegido <- ''
  
while (elegido != secreto) {

elegido <- as.integer(readline('Elija un número del 1 al 100: '))

  if(is.na(elegido)){
    print('Es necesario que se ingrese un número')
    break
    } 
}
```
Agregamos una nueva condición. Si el número es más grande que 100 o menor a 1, se imprime un mensaje de advertencia y continúa el ciclo.
```{r results = FALSE, warning = FALSE, message = FALSE}
nombre <- readline('¿Cómo es tu nombre? ')

cat(paste('Hola',nombre, 'bienvenidx al adivinador. ¿Tendrás suerte?\nElige un número del 1 al 100: ', sep= ' '))

secreto <- sample(1:100, size = 1)

elegido <- ''
  
while (elegido != secreto) {

elegido <- as.integer(readline('Elija un número del 1 al 100: '))

  if(is.na(elegido)){
    print('Es necesario que se ingrese un número')
    break
    } 

  if (elegido < 1 | elegido > 100) {
    print('El numero elegido está fuera de rango') }
}

```

Ya tenemos armadas las condiciones necesarias para el juego.
Ahora agreguemos mensajes para orientar al jugar con condicionales if/else if / else
Si se pasó o eligió un número muy bajo imprimimos mensajes de advertencia.
Si acertó, mensaje de felicitaciones y break para que corte el ciclo.
```{r results = FALSE, warning = FALSE, message = FALSE}
nombre <- readline('¿Cómo es tu nombre? ')

cat(paste('Hola',nombre, 'bienvenidx al adivinador. ¿Tendrás suerte?\nElige un número del 1 al 100: ', sep= ' '))

secreto <- sample(1:100, size = 1)

elegido <- ''
  
while (elegido != secreto) {

elegido <- as.integer(readline('Elija un número del 1 al 100: '))

  if(is.na(elegido)){
    print('Es necesario que se ingrese un número')
    break
    } 

  if (elegido < 0 | elegido > 100) {
    print('El numero elegido está fuera de rango')
  
    } else if (elegido > secreto){
    print('Te pasaste! Probá con un número más bajo!')
  
    } else if (elegido < secreto){
    print('Incorrecto! Tu número es muy bajo!')
  
    } else {
    print('Felicitaciones! acertaste el número!')
      break
      }
}

```

Agregamos un último mensaje. Si acierta, le preguntamos si quiere volver a jugar. Si la respuesta es 's', se resetea la variable "elegido" y vuelve a empezar el ciclo con el comando "next" y reseteamos el número a elegir.
De lo contrario, se imprime un mensaje de agradecimiento y se cortá el ciclo indefinido con "break"
```{r results = FALSE, warning = FALSE, message = FALSE}

nombre <- readline('¿Cómo es tu nombre? ')

cat(paste('Hola',nombre, 'bienvenidx al adivinador. ¿Tendrás suerte?\nElige un número del 1 al 100: ', sep= ' '))

secreto <- sample(1:100, size = 1)

elegido <- ''
  
while (elegido != secreto) {

  elegido <- as.integer(readline('Elija un número del 1 al 100: '))

  if(is.na(elegido)){
    print('Es necesario que se ingrese un número')
    break
    } 

  if (elegido < 0 | elegido > 100) {
    print('El numero elegido está fuera de rango')
  
    } else if (elegido > secreto){
    print('Te pasaste! Probá con un número más bajo!')
  
    } else if (elegido < secreto){
    print('Incorrecto! Tu número es muy bajo!')
  
    } else {
        print('Felicitaciones! acertaste el número!')
    
        continuar <- readline(print('¿Querés volver a jugar? s/n: '))
    
        if(continuar == 's'){
          elegido <- ''
          secreto <- sample(1:100, size = 1)
          next
        }else {
          print('Gracias por jugar, hasta la próxima!')
          break
         }
     } 
  }
```
